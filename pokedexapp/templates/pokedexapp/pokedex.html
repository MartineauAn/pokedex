{% extends 'pokedexapp/layout/base.html' %}

{% load static %}
{% block styles %}
{% endblock styles %}

{% block content %}
     
    <div class="grid md:grid-cols-3 lg:grid-cols-3 sm:grid-rows-3 md:grid-rows-1 lg:grid-rows-1 h-screen">
        <div class="md:col-span-2 lg:col-span-2 sm:col-grid-2">
            <div class="flex justify-between mx-auto w-3/4 mt-5">
                <div id="name" class="font-extrabold">
                      
                </div>
                <div id="number" class="font-extrabold">
                      
                </div>
            </div>
            <div id="pokemon" class="border border-indigo-700 mx-auto h-2/3 w-2/3 mt-5 rounded-xl shadow-2xl"></div> 
            <div id="tags" class="mx-auto w-3/4 flex justify-end">

            </div> 
        </div>
        <div class="md:col-span-1 lg:col-span-1 sm:col-grid-1">
            <div class="p-1 m-2 h-16">
                <input type="text" onkeyup="chercher(this)" class="p-3 w-11/12" placeholder="Rechercher...">
            </div>
                <div id="pokemon_list" class="overflow-auto h-screen">
                {% for pokemon in pokemon.results %}
                    <div onclick="afficher({{forloop.counter}})" id="{% if forloop.counter < 10 %}00{% elif forloop.counter < 100 %}0{% endif %}{{ forloop.counter }}_{{ pokemon.name }}" class="affichage m-2 shadow-md bg-gradient-to-r from-cyan-500 to-blue-500 border-sm border-black rounded-l-full p-3 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-blue-600 hover:cursor-pointer">
                        <div class="flex justify-start ml-2 font-bold">
                            #{% if forloop.counter < 10 %}00{% elif forloop.counter < 100 %}0{% endif %}{{ forloop.counter }} - {{ pokemon.name }}
                        </div>   
                    </div>
                {% endfor %}
                </div>   
            
        </div>
    </div>

{% endblock content %}

{% block scripts %}
    <script src="./static/pokedexapp/three.js"></script>
    <script src="./static/pokedexapp/orbitControls.js"></script>
    <script src="./static/pokedexapp/gtlfLoader.js"></script>
    <script src="./static/pokedexapp/pokemon.js"></script>
    <script>

        const dimRef = {
            x: 0.036014377111069695,
            y: 0.04604668111333994,
            z: 0.054992468419668206
        }

        afficher(1);

        function afficher(numero){
            var httpRequest = new XMLHttpRequest()
            httpRequest.open("GET","https://pokeapi.co/api/v2/pokemon/" + numero);
            httpRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    const pokemons = JSON.parse(this.response)
                    document.querySelector("#name").innerHTML = String(pokemons.name).toUpperCase()
                    document.querySelector("#number").innerHTML = (pokemons.id < 10 ? "00" : pokemons.id < 100 ? "0" : "") + pokemons.id
                    
                    if (objetPokemon != undefined){
                       scene.remove(objetPokemon); 
                    }
                    
                    loader = new GLTFLoader();
                    loader.load( 
                    chemin + "/objects/" + pokemons.id + ".glb",
                    function ( gltf ) {
                        
                        objetPokemon = gltf.scene;

                        console.log(objetPokemon.position)

                        objetPokemon.position.set(0,0,0);

                        const box = new THREE.Box3().setFromObject(objetPokemon); 
                        const size = box.getSize(new THREE.Vector3());

                        console.log(size)

                        fitCameraToCenteredObject(camera,objetPokemon,50,controls)

                        //objetPokemon.scale.set(0.75, 0.75, 0.75);
                        scene.add(objetPokemon);
                        //camera.lookAt(objetPokemon.position);
                        //controls.update();

                    },
                    );
                }
            }
            httpRequest.send();
            
        }

        function chercher(object){

            if(object.value != ""){
                elems = document.querySelectorAll("#pokemon_list .affichage:not([id*='" + object.value + "'])");
                elemsV = document.querySelectorAll("#pokemon_list .affichage[id*='" + object.value + "']");

                hide(elems);
                show(elemsV);
            }
            else{
                elems = document.querySelectorAll("#pokemon_list .affichage");

                show(elems);
            }
            


        }

        function hide(elements){
            elements.forEach(element => {
                element.hidden = true;
            });
        }

        function show(elements){
            elements.forEach(element => {
                element.hidden = false;
            });  
        }




    </script>
{% endblock scripts %}