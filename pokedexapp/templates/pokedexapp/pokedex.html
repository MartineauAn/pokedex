{% extends 'pokedexapp/layout/base.html' %}

{% load static %}
{% block styles %}
{% endblock styles %}

{% block content %}
    <div class="flex bg-blue-300 h-full">
        <div class="flex-none w-14 h-full bg-amber-200">

        </div>
        <div class="flex-1">
            <div class="justify-between mx-auto w-3/4 mt-5">
                <div id="name" class="font-extrabold">
                      
                </div>
                <div id="number" class="font-extrabold">
                      
                </div>
            </div>
            <div class="container mx-auto"></div>

            <div id="pokemon" class="border-4 border-sky-500 mx-auto h-2/3 w-2/3 mt-5 rounded-xl shadow-2xl"></div> 

            <div id="tags" class="mx-auto w-3/4 flex justify-end">

            </div> 
        </div>
        <div class="flex-1 overflow-auto grid grid-rows-6 grid-flow-col gap-4">
            <div class="flex justify-center p-1 m-2 row-span-1 h-16">
                <input type="text" onkeyup="chercher(this)" class="p-3 w-11/12" placeholder="Rechercher...">
            </div>
            <div id="pokemon_list" class="overflow-auto row-span-1 row-span-5 h-full">
                {% for pokemon in pokemon.results %}
                    <div id="{% if forloop.counter < 10 %}00{% elif forloop.counter < 100 %}0{% endif %}{{ forloop.counter }}_{{ pokemon.name }}" onclick="afficher({{forloop.counter}})" class="affichage m-2 shadow-md bg-amber-200 border-sm border-black rounded-l-full p-3 hover:bg-amber-500 hover:cursor-pointer">
                        <div class="flex justify-start ml-2 font-bold">
                            #{% if forloop.counter < 10 %}00{% elif forloop.counter < 100 %}0{% endif %}{{ forloop.counter }} - {{ pokemon.name }}
                        </div>   
                    </div>
                {% endfor %}
                </div>   
            
        </div>
    </div>


{% endblock content %}

{% block scripts %}
    <script src="./static/pokedexapp/three.js"></script>
    <script src="./static/pokedexapp/orbitControls.js"></script>
    <script src="./static/pokedexapp/gtlfLoader.js"></script>
    <script src="./static/pokedexapp/pokemon.js"></script>
    <script>

        const dimRef = {
            x: 0.036014377111069695,
            y: 0.04604668111333994,
            z: 0.054992468419668206
        }

        afficher(1);

        function afficher(numero){
            var httpRequest = new XMLHttpRequest()
            httpRequest.open("GET","https://pokeapi.co/api/v2/pokemon/" + numero);
            httpRequest.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    const pokemons = JSON.parse(this.response)
                    document.querySelector("#name").innerHTML = String(pokemons.name).toUpperCase()
                    document.querySelector("#number").innerHTML = (pokemons.id < 10 ? "00" : pokemons.id < 100 ? "0" : "") + pokemons.id
                    
                    if (objetPokemon != undefined){
                       scene.remove(objetPokemon); 
                    }
                    
                    loader = new GLTFLoader();
                    loader.load( 
                    chemin + "/objects/" + pokemons.id + ".glb",
                    function ( gltf ) {
                        
                        objetPokemon = gltf.scene;

                        console.log(objetPokemon.position)

                        objetPokemon.position.set(0,0,0);

                        objetPokemon.rotateY(0.40)

                        const box = new THREE.Box3().setFromObject(objetPokemon); 
                        const size = box.getSize(new THREE.Vector3());

                        console.log(size)

                        fitCameraToCenteredObject(camera,objetPokemon,size.y > 10 ? 2 : 65,controls)

                        camera.position.y = 3

                        scene.add(objetPokemon);

                    },
                    );
                }
            }
            httpRequest.send();
            
        }

        function chercher(object){

            if(object.value != ""){
                elems = document.querySelectorAll("#pokemon_list .affichage:not([id*='" + object.value + "'])");
                elemsV = document.querySelectorAll("#pokemon_list .affichage[id*='" + object.value + "']");

                hide(elems);
                show(elemsV);
            }
            else{
                elems = document.querySelectorAll("#pokemon_list .affichage");

                show(elems);
            }
            


        }

        function hide(elements){
            elements.forEach(element => {
                element.hidden = true;
            });
        }

        function show(elements){
            elements.forEach(element => {
                element.hidden = false;
            });  
        }




    </script>
{% endblock scripts %}